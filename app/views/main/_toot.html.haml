%li
  - toot_handle       = toot.attributes.account.username
  - toot_display_name = toot.attributes.account.display_name

  - if !toot.attributes.reblog.blank?
    .boost
      ↺
      .display_name
        = toot_display_name
      boosted
    - toot_handle       = toot.attributes.reblog.account.username
    - toot_display_name = toot.attributes.reblog.account.display_name
    - toot_user_avatar  = toot.attributes.reblog.account.avatar
    - toot_user_link    = toot.attributes.reblog.account.url
    - toot_link         = toot.attributes.reblog.url
    - toot_spoiler      = toot.attributes.reblog.spoiler_text
    - toot_text         = toot.attributes.reblog.content
    - boost_count       = toot.attributes.reblog.reblogs_count
    - fave_count        = toot.attributes.reblog.favourites_count
    - media             = toot.reblog.media_attachments
  - else
    - toot_user_avatar  = toot.attributes.account.avatar
    - toot_user_link    = toot.attributes.account.url
    - toot_link         = toot.attributes.url
    - toot_spoiler      = toot.attributes.spoiler_text
    - toot_text         = toot.attributes.content
    - boost_count       = toot.attributes.reblogs_count
    - fave_count        = toot.attributes.favourites_count
    - media             = toot.media_attachments
      
  .user_pic
    - if !toot_user_avatar.blank?
      = link_to image_tag(toot_user_avatar, alt: toot_display_name, title:toot_display_name), toot_user_link, target: '_blank'

  .toot
    .user_name
      .display_name
        = toot_display_name
      .handle
        = link_to "@#{toot_handle}", toot_user_link, target: '_blank'

    .toot_content
      - if !toot_spoiler.blank?
        .spoiler{id: "spoiler_#{toot.id}"}
          = toot_spoiler
        :javascript
          $(document).ready(function() {
            $('#toot_#{toot.id}').hide();
            $('#spoiler_#{toot.id}').click(function() {
              $('#toot_#{toot.id}').toggle(400);
            });
          });
      %div{id: "toot_#{toot.id}"}
        = simple_format sanitize(toot_text, tags: %w(a img p br span), attributes: %w(href target src class)), {}, sanitize: false # simple format was double sanitizing
        - if !media.blank?
          %p
            - media.each do |medium|
              = link_to image_tag(medium.attributes.preview_url, alt: medium.attributes.description, title: medium.attributes.description, width: medium.attributes.meta.small.width, height: medium.attributes.meta.small.height), medium.attributes.url, class: 'toot_thumbnail'

    .reach
      %span{title: pluralize(boost_count, 'boost')}
        = "↺ #{boost_count}"
      %span{title: pluralize(fave_count, 'florp')}
        = "☆ #{fave_count}"

  .time_ago
    = link_to time_ago_in_words(toot.created_at.to_datetime)+' ago', toot_link, target: '_blank'